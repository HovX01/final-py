<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Site{% endblock %}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      body { background: radial-gradient(100% 100% at 10% 10%, #1e293b, #0b1224), radial-gradient(80% 80% at 80% 0%, #0a3b34, #0b1224), #0f172a; }
      input, select, textarea {
        width: 100%;
        background: #0f172a;
        border: 1px solid #1f2937;
        border-radius: 0.5rem;
        padding: 0.55rem 0.75rem;
        color: #e2e8f0;
      }
    </style>
</head>
<body class="min-h-screen text-slate-100">
    <header class="border-b border-slate-800/80 bg-slate-950/60 backdrop-blur">
        <div class="mx-auto max-w-6xl px-6 py-4 flex items-center justify-between">
            <div class="flex items-center gap-6">
                <a href="{% url 'home' %}" class="text-lg font-extrabold tracking-tight">ST-Lorkan</a>
                <a href="{% url 'catalog:product_list' %}" class="text-slate-200 hover:text-emerald-300 transition">Products</a>
                {% if user.is_authenticated %}
                <a href="{% url 'billing:cart' %}" class="relative text-slate-200 hover:text-emerald-300 transition">
                    Cart
                    {% if cart_item_count %}
                    <span id="cart-count" class="absolute -top-2 -right-4 rounded-full bg-emerald-500 px-2 text-xs font-bold text-slate-950">{{ cart_item_count }}</span>
                    {% else %}
                    <span id="cart-count" class="hidden"></span>
                    {% endif %}
                </a>
                {% endif %}
            </div>
            <div class="flex items-center gap-3">
                {% if user.is_authenticated %}
                    {% if user.user_type == 'basic' %}
                        <a href="{% url 'billing:subscribe_page' %}" class="rounded-full border border-emerald-400/70 px-4 py-2 text-sm font-semibold text-emerald-200 hover:bg-emerald-400/10 transition">Upgrade to Pro ($20/mo)</a>
                    {% endif %}
                    <a href="{% url 'accounts:profile' %}" class="text-slate-200 hover:text-emerald-300 transition">Profile</a>
                    <a href="{% url 'accounts:logout' %}" class="text-slate-200 hover:text-emerald-300 transition">Logout</a>
                {% else %}
                    <a href="{% url 'accounts:login' %}" class="text-slate-200 hover:text-emerald-300 transition">Login</a>
                    <a href="{% url 'accounts:register' %}" class="text-slate-200 hover:text-emerald-300 transition">Register</a>
                {% endif %}
            </div>
        </div>
    </header>

    <main class="mx-auto max-w-6xl px-6 py-8">
        {% if messages %}
            <div class="space-y-2 mb-4">
                {% for message in messages %}
                    <div class="rounded-lg border border-emerald-400/40 bg-emerald-500/10 px-4 py-3 text-sm">{{ message }}</div>
                {% endfor %}
            </div>
        {% endif %}
        {% block content %}{% endblock %}
    </main>
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        document.querySelectorAll('form[data-cart-add]').forEach(form => {
          form.addEventListener('submit', async (e) => {
            e.preventDefault();
            const resp = await fetch(form.action, {method:'POST', body: new FormData(form), headers:{'X-Requested-With':'XMLHttpRequest'}});
            if (!resp.ok) { form.submit(); return; }
            const data = await resp.json();
            if (data.cart_count !== undefined) {
              const badge = document.getElementById('cart-count');
              if (badge) {
                badge.textContent = data.cart_count;
                badge.classList.remove('hidden');
              }
            }
          });
        });
      });
    </script>
</body>
</html>
